<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- ğŸš€ ê°•ë ¥í•œ ìºì‹œ ë°©ì§€ ë©”íƒ€íƒœê·¸ë“¤ - ëª¨ë°”ì¼ ìºì‹œ ë¬¸ì œ í•´ê²° -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <meta http-equiv="Last-Modified" content="0" />
    <meta http-equiv="If-Modified-Since" content="0" />
    <meta name="cache-version" content="v1.0.5-20250914" />

    <meta name="theme-color" content="#3b82f6" />
    <!-- Firefox í˜¸í™˜ì„±ì„ ìœ„í•œ ì¶”ê°€ ë©”íƒ€ íƒœê·¸ -->
    <meta name="msapplication-TileColor" content="#3b82f6" />
    <meta name="msapplication-navbutton-color" content="#3b82f6" />
    <meta name="apple-mobile-web-app-status-bar-style" content="#3b82f6" />

    <meta name="description" content="íŠ¹ìˆ˜êµìœ¡ ìš©ì–´ ì‚¬ì „ - ìƒí™œì–´ë¥¼ ì „ë¬¸ìš©ì–´ë¡œ ì‰½ê²Œ ë³€í™˜í•˜ëŠ” ì•±" />

    <!-- PWA ë©”íƒ€ íƒœê·¸ -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="íŠ¹ìˆ˜êµìœ¡ì‚¬ì „" />
    <meta name="mobile-web-app-capable" content="yes" />

    <!-- ì•„ì´ì½˜ ì„¤ì • -->
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/favicon.ico" />
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://special-education-dictionary.app/" />
    <meta property="og:title" content="íŠ¹ìˆ˜êµìœ¡ ìš©ì–´ ì‚¬ì „" />
    <meta property="og:description" content="ìƒí™œì–´ë¥¼ ì „ë¬¸ìš©ì–´ë¡œ ì‰½ê²Œ ë³€í™˜í•˜ê³  ë²•ë ¹ ì˜ˆë¬¸ê¹Œì§€ í™•ì¸í•  ìˆ˜ ìˆëŠ” íŠ¹ìˆ˜êµìœ¡ ìš©ì–´ ì‚¬ì „" />
    <meta property="og:image" content="%PUBLIC_URL%/favicon.ico" />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary" />
    <meta property="twitter:url" content="https://special-education-dictionary.app/" />
    <meta property="twitter:title" content="íŠ¹ìˆ˜êµìœ¡ ìš©ì–´ ì‚¬ì „" />
    <meta property="twitter:description" content="ìƒí™œì–´ë¥¼ ì „ë¬¸ìš©ì–´ë¡œ ì‰½ê²Œ ë³€í™˜í•˜ê³  ë²•ë ¹ ì˜ˆë¬¸ê¹Œì§€ í™•ì¸í•  ìˆ˜ ìˆëŠ” íŠ¹ìˆ˜êµìœ¡ ìš©ì–´ ì‚¬ì „" />
    <meta property="twitter:image" content="%PUBLIC_URL%/favicon.ico" />
    
    <title>íŠ¹ìˆ˜êµìœ¡ ìš©ì–´ ì‚¬ì „</title>
  </head>
  <body>
    <noscript>JavaScriptë¥¼ í™œì„±í™”í•´ì•¼ ì´ ì•±ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</noscript>
    <div id="root"></div>
    
    <!-- ğŸš€ ê°•í™”ëœ PWA ë° ìºì‹œ ê´€ë¦¬ -->
    <script>
      // í˜„ì¬ ì•± ë²„ì „
      const APP_VERSION = 'v1.0.5-20250914';

      window.addEventListener('load', () => {
        console.log('ğŸš€ ì•± ë¡œë”© ì‹œì‘ - ë²„ì „:', APP_VERSION);

        // 1. ì„œë¹„ìŠ¤ì›Œì»¤ ê°•ì œ ì—…ë°ì´íŠ¸
        if ('serviceWorker' in navigator) {
          navigator.serviceWorker.register('/service-worker.js')
            .then((registration) => {
              console.log('âœ… SW registered:', registration);
              // ê°•ì œ ì—…ë°ì´íŠ¸ ì²´í¬
              registration.update();

              // ìƒˆë¡œìš´ ì„œë¹„ìŠ¤ì›Œì»¤ê°€ ì¤€ë¹„ë˜ë©´ ì¦‰ì‹œ í™œì„±í™”
              registration.addEventListener('updatefound', () => {
                const newWorker = registration.installing;
                newWorker.addEventListener('statechange', () => {
                  if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                    console.log('ğŸ”„ ìƒˆë¡œìš´ ë²„ì „ì´ ì¤€ë¹„ë¨ - ìƒˆë¡œê³ ì¹¨ ê¶Œì¥');
                    // ìë™ ìƒˆë¡œê³ ì¹¨ (ì£¼ì„ í•´ì œí•˜ë©´ í™œì„±í™”)
                    // window.location.reload();
                  }
                });
              });
            })
            .catch((error) => {
              console.log('âŒ SW registration failed:', error);
            });

          // ëª¨ë“  ì„œë¹„ìŠ¤ì›Œì»¤ ê°•ì œ ì—…ë°ì´íŠ¸
          navigator.serviceWorker.getRegistrations().then((registrations) => {
            registrations.forEach((registration) => {
              registration.update();
            });
          });
        }

        // 2. ì•± ë²„ì „ ì²´í¬ ë° ìºì‹œ ì´ˆê¸°í™”
        const storedVersion = localStorage.getItem('app-version');
        if (storedVersion !== APP_VERSION) {
          console.log('ğŸ”„ ë²„ì „ ì—…ë°ì´íŠ¸ ê°ì§€:', storedVersion, 'â†’', APP_VERSION);
          // í…Œë§ˆ ì„¤ì •ë§Œ ë³´ì¡´í•˜ê³  ë‚˜ë¨¸ì§€ ì´ˆê¸°í™”
          const savedTheme = localStorage.getItem('theme');
          localStorage.clear();
          if (savedTheme) {
            localStorage.setItem('theme', savedTheme);
          }
          localStorage.setItem('app-version', APP_VERSION);
        }

        // 3. ëª¨ë°”ì¼ ì „ìš© ë””ë²„ê¹… ë„êµ¬
        if (/Mobi|Android|iPhone|iPad/i.test(navigator.userAgent)) {
          const debugDiv = document.createElement('div');
          debugDiv.style.cssText = `
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(239, 68, 68, 0.95);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            z-index: 999999;
            font-family: monospace;
            font-size: 11px;
            line-height: 1.3;
            max-width: 300px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
          `;
          debugDiv.innerHTML = `
            ğŸ“± Mobile Debug Info<br>
            â° ${new Date().toLocaleString()}<br>
            ğŸ“¦ Version: ${APP_VERSION}<br>
            ğŸ¨ Theme: ${document.documentElement.getAttribute('data-theme') || 'light'}<br>
            ğŸŒ UA: ${navigator.userAgent.includes('iPhone') ? 'iPhone' : navigator.userAgent.includes('Android') ? 'Android' : 'Mobile'}<br>
            ğŸ”„ Click to dismiss
          `;

          debugDiv.onclick = () => debugDiv.remove();
          document.body.appendChild(debugDiv);

          // 5ì´ˆ í›„ ìë™ ì œê±°
          setTimeout(() => {
            if (debugDiv.parentNode) debugDiv.remove();
          }, 5000);
        }

        // 4. í…Œë§ˆ ì‹œìŠ¤í…œ ì¦‰ì‹œ í™œì„±í™” (ìºì‹œ ë¬¸ì œ ë°©ì§€)
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
          document.documentElement.setAttribute('data-theme', 'dark');
          document.body.classList.add('dark-theme');
          console.log('ğŸŒ™ ë‹¤í¬ í…Œë§ˆ ì¦‰ì‹œ ì ìš©');
        }
      });

      // 5. í˜ì´ì§€ ê°€ì‹œì„± ë³€ê²½ ì‹œ ê°•ì œ ì—…ë°ì´íŠ¸ ì²´í¬
      document.addEventListener('visibilitychange', () => {
        if (document.visibilityState === 'visible') {
          if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then((registrations) => {
              registrations.forEach((registration) => {
                registration.update();
              });
            });
          }
        }
      });
    </script>
  </body>
</html>